<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">    
    <!--<meta http-equiv="refresh" content="5; URL=http://localhost/Modern%20Air/src/" /> -->
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="../img/Logo_min.svg" rel="icon" type="image/svg" />   
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.1/css/all.min.css" />
    <link rel="stylesheet" href="https://www.w3schools.com/w3css/4/w3.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <title>Modern Air - Lüften neu definiert | Webserver</title>

    <style>
        html{
            height: 100%;
        }
        /* Body */
        body {
            margin: 0;
            font-family: Arial, Helvetica, sans-serif;
            min-height: 100%;
            display: grid;
            grid-template-rows: 1fr auto
        }
        /* Content */
        .content{
            min-height: 100%;
            
        }
        /* Navbar */
        .navbar{
            background-color: #29ABE2;
            overflow: hidden;
            padding: 0px 10% 0px 10%;
        }
        .dropdown{
            text-align: center;
            float: left;
            overflow: hidden;
            
        }
        .dropbtn{
            font-size: 17px;
            border: none;
            outline: none;
            color: white;
            padding: 14px 16px;
            background-color: inherit;
            font-family: inherit;
            margin: 0;
            font-weight: bold;
        }
        .dropdown-content{
            display: none;
            position: absolute;
            background-color: #f9f9f9;
            min-width: 200px;
            box-shadow: 0px 8px 16px 0px rgba(0,0,0,0.2);
            z-index: 1;
        }
        .dropdown-content a {
            float: none;
            color: black;
            padding: 12px 16px;
            text-decoration: none;
            display: block;
            text-align: left;
        }
        .dropdown-content a:hover {
            background-color: #ddd;
            color: black;
        }
        .dropdown:hover .dropdown-content {
            display: block;
        }
        /* Banner */
        .banner{
            padding: 0px 10% 0px 10%;
            background-color: whitesmoke;
        }
        /* Footer */
        .footer{
            grid-row-start: 2;
            grid-row-end: 3;
            position: relative;
            bottom: 0;
            width: 100%;
            background-color: whitesmoke;
            color: black;
            align-items: center;
            display: flex;
            justify-content: space-evenly;
            flex-shrink: 0;        
        }
        .footer img{
            max-width: 50px;
            max-height: 50px;
        }
        .footer a{
            color: #0366D6;
            text-decoration: none;
        }
        .footer i{
            padding-right: 2px;
        }
        .footer a:hover{
            text-decoration: underline;
        }
        /* Boxing */
        .box{
            margin: 20px 10% 20px 10%;
        }
        .box-header{
            padding: 16px;
            margin: -1px -1px 0;
            border: 1px solid; 
            border-top-left-radius: 6px;
            border-top-right-radius: 6px;
            background-color: #F1F8FF;
            border-color:#c1ddff;
        }
        .box-footer{
            padding: 16px;
            margin: -1px -1px 0;
            border: 1px solid; 
            border-bottom-left-radius: 6px;
            border-bottom-right-radius: 6px;
            background-color: white;
            border-color: #e0e3e7;
        }
        .box-footer a{
            text-decoration: none;
        }
        .box-footer i{
            padding-right: 2px;
        }
        .box-footer a:hover{
            text-decoration: underline;
        }
        .container {
            margin: 20px 10% 20px 10%;
            display: flex;
            flex-direction: row;
            justify-content: space-between;  
            flex-wrap: wrap;
        }
        /* Buttons */
        .activebutton_on{
            padding-top: 2%;
            padding-bottom: 2%;
            margin: 10px;
            background-color: #4CAF50;
            color: white;
            border-radius: 18px;
            border: none;
            text-align: center;
        }
        .inactivebutton_on{
            padding-top: 2%;
            padding-bottom: 2%;
            margin: 10px;
            background-color: #f44336;
            color: white;
            border-radius: 18px;
            text-align: center;
            border: none;
        }
        .activebutton_on:hover, .activebutton_on:focus {
            outline: none;
            cursor: pointer;
            opacity: 0.8;
        }
        .inactivebutton_on:hover, .inactivebutton_on:focus {
            outline: none;
            cursor: pointer;
            opacity: 0.8;
        }      
        /* Status */
        .active_on{
            padding-top: 2%;
            padding-bottom: 2%;
            margin: 10px;
            background-color: #4CAF50;
            color: white;
            border-radius: 18px;
            border: none;
            text-align: center;
        }
        .inactive_on{
            padding-top: 2%;
            padding-bottom: 2%;
            margin: 10px;
            background-color: #f44336;
            color: white;
            border-radius: 18px;
            text-align: center;
            border: none;
        }
        .active_off{
            padding-top: 2%;
            padding-bottom: 2%;
            margin: 10px;
            background-color: #4CAF50;
            color: white;
            opacity: 0.6;
            cursor: not-allowed;
            border-radius: 18px;
            text-align: center;
            border: none;
        }
        .inactive_off{
            padding-top: 2%;
            padding-bottom: 2%;
            margin: 10px;
            background-color: #f44336;
            color: white;
            opacity: 0.6;
            cursor: not-allowed;
            border-radius: 18px;
            text-align: center;
            border: none;
        }
        /* Progressbar */
        .progresslin{
            width: 100%;
            background-color: grey;
            border-radius: 18px;
        }
        .barlin{
            width: 60%;
            height: 30px;
            background-color: #29ABE2;
            border-radius: 12px;
            text-align: center;
            line-height: 30px;
            color: white;
        }
        /* Card */
        .card{
            background-color: white;
            box-shadow: 0px 8px 16px 0px rgba(0,0,0,0.2);
            padding: 10px;
            border-radius: 10px;
            min-width: 45%;
        }
        .heading{
            text-align: center; 
            font-size: 17px; 
            font-weight: bold;  
            padding-bottom: 10px;
        }
        /* Modal */
        .modal{
            display: none;
            position: fixed; 
            z-index: 1;
            left: 0;
            top: 0;
            width: 100%; 
            height: 100%; 
            overflow: auto; 
            background-color: rgb(0,0,0); 
            background-color: rgba(0,0,0,0.4); 
        }
        .modal-content {
            background-color: #fefefe;
            margin: 15% auto; 
            padding: 20px;
            border: 2px solid;
            border-color:#c1ddff;
            width: 50%;
            border-radius: 10px; 
        }
        .close {
            color: #aaa;
            float: right;
            font-size: 28px;
            font-weight: bold;
        }
        .close:hover, .close:focus {
            color: black;
            text-decoration: none;
            cursor: pointer;
        }
 
    </style>
</head>
<body>
    <!--Content-->
    <div class="content">
    <!--Navbar-->
    <div class="navbar">
        <div class="dropdown">
            <button class="dropbtn"><i class="fas fa-fan"></i> Lüfter-Steuerung <i class="fa fa-caret-down"></i></button>
            <div class="dropdown-content">
                <a href="#fan_on" onclick="showmodal('modal_on')">Aktivieren</a>
                <a href="#fan_off" onclick="showmodal('modal_off')">Deaktivieren</a>
            </div>
        </div>
        <div class="dropdown">
            <button class="dropbtn"><i class="fas fa-code"></i> Demo <i class="fa fa-caret-down"></i></button>
            <div class="dropdown-content">
                <a href="#co2_eintragen" onclick="resetForm('co2_form'), showmodal('modal_co2')">CO2-Eintragen</a>
                <a href="#tmp_eintragen" onclick="resetForm('tmp_form'), showmodal('modal_tmp')">Tmp-Eintragen</a>
            </div>
        </div>
    </div>

    <!-- Modal_on -->
    <div id="modal_on" class="modal">

        <!-- Modal content -->
        <div class="modal-content w3-animate-bottom">
            <span class="close" onclick="closemodal('modal_on')">&times;</span>
            <h2>Lüfter-Steuerung</h2>
            <p>Lüfter wirklich <b>aktivieren?</b></p>
            <div style="text-align: right;">
            <button class="activebutton_on" onclick="closemodal('modal_on'), post('fan=on')">JA, aktivieren</button>
            <button class="inactivebutton_on" onclick="closemodal('modal_on')">Abbrechen</button>
            </div>
        </div>
    
        </div>


    <!-- Modal_off -->
    <div id="modal_off" class="modal">

        <!-- Modal content -->
        <div class="modal-content w3-animate-bottom">
            <span class="close" onclick="closemodal('modal_off')">&times;</span>
            <h2>Lüfter-Steuerung</h2>
            <p>Lüfter wirklich <b>deaktivieren?</b></p>
            <div style="text-align: right;">
            <button class="activebutton_on" onclick="closemodal('modal_off'), post('fan=off')">JA, deaktivieren</button>
            <button class="inactivebutton_on" onclick="closemodal('modal_off')">Abbrechen</button>
            </div>
        </div>
    
        </div>

    <!-- Modal_co2 -->
    <div id="modal_co2" class="modal">

        <!-- Modal content -->
        <div class="modal-content w3-animate-bottom">
            <span class="close" onclick="closemodal('modal_co2')">&times;</span>
            <h2>CO2-Eintragen</h2>

            <form action="postform/" id="co2_form" target="_blank" rel="noopener" enctype="text/plain" method="post">
                <input type="radio" id="co2_in" name="ort_wert" value="in" checked>
                <label for="co2_in">In</label><br>
                <input type="radio" id="co2_out" name="ort_wert" value="out">
                <label for="co2_out">Out</label><br><br> 
                
                <input type="number" id="co2_wert" placeholder="CO2-Wert" name="co2_wert" min="400" max="2000" required>
                <label for="co2_wert">CO2 Wert in ppm (400-2000)</label><br>
                <input type="number" id="co2_time" placeholder="Zeit-Wert" name="time_wert" min="0" required>
                <label for="co2_time">Zeit in ms</label><br>
            </form>



            <div style="text-align: right;">
            <button class="activebutton_on" onclick="submitCO2()">CO2 senden</button>
            <button class="inactivebutton_on" onclick="closemodal('modal_co2')">Abbrechen</button>
            </div>
        </div>
    
        </div>        

    <!-- Modal_tmp -->
    <div id="modal_tmp" class="modal">

        <!-- Modal content -->
        <div class="modal-content w3-animate-bottom">
            <span class="close" onclick="closemodal('modal_tmp')">&times;</span>
            <h2>Tmp-Eintragen</h2>

            <form action="postform/" id="tmp_form" target="_blank" rel="noopener" enctype="text/plain" method="post">
                <input type="radio" id="tmp_in" name="ort_wert" value="in" checked>
                <label for="tmp_in">In</label><br>
                <input type="radio" id="tmp_out" name="ort_wert" value="out">
                <label for="tmp_out">Out</label><br><br> 
                
                <input type="number" id="tmp_wert" placeholder="Tmp-Wert" name="tmp_wert" min="-40" max="30" required>
                <label for="tmp_wert">Tmp Wert in °C (-40-30)</label><br>
                <input type="number" id="tmp_time" placeholder="Zeit-Wert" name="time_wert" min="0" required>
                <label for="tmp_time">Zeit in ms</label><br>                 
            </form>

            <div style="text-align: right;">
            <button class="activebutton_on" onclick="submitForm('modal_tmp, tmp_form, ort_wert, tmp_wert, time_wert')">Tmp senden</button>
            <button class="inactivebutton_on" onclick="closemodal('modal_tmp')">Abbrechen</button>
            </div>
        </div>
    
        </div>        

    <!--Banner-->
    <div class="banner">
        <img src="../img/Logo.svg" alt="Logo-Banner">
    </div>

  

    <!--Farblegende-->
    <div class="box">
        <div class="box-header" style="display: flex; flex-direction: row;">
            <div><i class="fas fa-paint-roller"></i> Farblegende</div>
        </div>
        <div class="box-footer" style="display: flex; flex-direction: row;" >
            <div class="barlin" style="background-color: #29ABE2; width: 10%; margin-right: 10px;" >Normal</div>
            <div class="barlin" style="background-color: #ff9800; width: 10%; margin-right: 10px;" >Hoch</div>
            <div class="barlin" style="background-color: #f44336; width: 10%; margin-right: 10px;" >Kritisch</div>
            
            <a href="#update" onclick="update()" class="barlin" style="background-color: #29ABE2; width: 10%; margin-left: 10px;" ><i class="fas fa-redo"></i>Refresh</a>
        </div>
    </div>

    <!--Lüfter-->
    <div class="box">
        <div class="box-header">
            <i class="fas fa-fan"></i> Lüfter
        </div>
        <div class="box-footer" style="display: flex; flex-direction: row; justify-content: space-between; align-items: stretch;">
            <div class="card" >
                <div class="active_on">Active</div>
                <div class="inactive_off">Inactive</div>
            </div>

            <div class="card" style="display: flex; flex-direction: column; justify-content: center;">   
                <div class="heading"><i class="fas fa-redo"></i> Lüfterumderhungen</div>
                <div class="progresslin">
                    <div class="barlin" style="width: 60%;">836 RPM</div>
                </div>
            </div>            
        </div>
    </div>

    <!--Container-->
    <div class="container">
        <!--CO2-->
        <div style="width: 49%;">
            <div class="box-header">
                <i class="fas fa-cloud"></i> CO2-Gehalt
            </div>
            <div class="box-footer" style="display: flex; flex-direction: row; justify-content: space-around; align-items: center;" >
                <div class="card">
                    <div class="heading"><i class="fas fa-home"></i> In-CO2</div>
                    <div class="progresslin">
                        <div class="barlin" style="width: 60%; background-color: #ff9800;">1266 PPM</div>
                    </div>
                </div>
                <div class="card">
                    <div class="heading"><i class="fas fa-leaf"></i> Out-CO2</div>
                    <div class="progresslin">
                        <div class="barlin" style="width: 24%;">421 PPM</div>
                    </div>
                </div>
            </div> 
             
        </div>

        <!--Tmp-->
        <div style="width: 49%;">
            <div class="box-header">
                <i class="fas fa-thermometer-half"></i> Temperatur
            </div>
            <div class="box-footer" style="display: flex; flex-direction: row; justify-content: space-around; align-items: center;" >
                <div class="card">
                    <div class="heading"><i class="fas fa-home"></i> In-Tmp</div>
                    <div class="progresslin">
                        <div class="barlin" style="width: 100%; background-color: #f44336;">30 °C</div>
                    </div>
                </div>
                <div class="card">
                    <div class="heading"><i class="fas fa-leaf"></i> Out-Tmp</div>
                    <div class="progresslin">
                        <div class="barlin" style="width: 30%;">10 °C</div>
                    </div>
                </div>
            </div>  
        </div>
    </div>

    <!--Footer-->
    <!-- Modal_impressum -->
    <div id="modal_impressum" class="modal">

    <!-- Modal content -->
    <div class="modal-content w3-animate-bottom">
        <span class="close" onclick="closemodal('modal_impressum')">&times;</span>
        <h2>Impressum</h2>
        <i>Dies ist der Webserver des Jufo-Projektes "Modern Air - Lüften neu definiert" zur Wettbewerbsrunde 2021</i>
        <h3>Aktuell entwickelt von:</h3>
        <ul>
            <li>Torben Heine</li>
            <li>Paul Paysan</li>
        </ul>
    </div>

    </div>
<!-- End content -->    
</div>
<!-- End content -->
    <div style="padding-left: 10%; padding-right: 10%; background-color: whitesmoke;">
    <div class="footer">
        <a href="#modal_impressum" onclick="showmodal('modal_impressum')"><i class="fas fa-info-circle"></i>Impressum</a>
        <img src="../img/Logo_min.svg" alt="Logo_min" >
        <a href="https://github.com/showetek/Modern-Air" target="_blank" rel="noopener"><i class="fab fa-github"></i>GitHub</a>
    </div>
    </div>
<script>
    //Modal
    function showmodal(id){
        modal = document.getElementById(id);
        modal.style.display = "block";        
    }
    function closemodal(id){
        modal = document.getElementById(id);
        modal.style.display = "none";
    }

    window.onclick = function(event) {
        if (event.target == modal) {
            modal.style.display = "none";
        }
    }

    //submitCO2
    function submitCO2(){
        submitForm("modal_co2", "co2_form", "ort_wert", "co2_wert", "time_wert");
    }


    //validateForm
    function validateForm(form_id, name_wert, name_time) {
        var result = true;
        var messsage = "";

        var x = document.forms[form_id][name_wert].value;
            if (x == "") {
                messsage = messsage + "Das Feld "+x.attr("placeholder")+" muss gefüllt sein!\n";
                result = false;
            }
            if (parseInt(x.val()) > parseInt(x.attr("max")) || parseInt(x.val()) < parseInt(x.attr("min")) ) {
                messsage = messsage + "Das Feld "+x.attr("placeholder")+" muss eine Zahl zwischen "+x.attr("min")+" und "+x.attr("max")+ "sein!\n";
                result = false;
            }

        var x = document.forms[form_id][name_time];
            if (x.val() == "") {
                messsage = messsage + "Das Feld "+x.attr("placeholder")+" muss gefüllt sein!\n";
                result = false;
            }
            if (parseInt(x.val()) > parseInt(x.attr("max")) || parseInt(x.val()) < parseInt(x.attr("min")) ) {
                messsage = messsage + "Das Feld "+x.attr("placeholder")+" muss eine Zahl zwischen "+x.attr("min")+" und "+x.attr("max")+ "sein!\n";
                result = false;
            }


        if (result == false) {
            alert("Folgende Fehler liegen vor:\n" + messsage);
        }
            

        return result;
    }

    //generatePostString
    function generatePostString(form_id, name_ort, name_wert, name_time) {
        var answer = "";
        var arg_wert = "";
        var arg_time = "";
        var ort  = document.forms[form_id][name_ort];
        var wert = document.forms[form_id][name_wert];
        var time = document.forms[form_id][name_time];
        

        for (let i = 0; i < length(name_wert); i++) {
            arg_wert = arg_wert + name_wert[i];  
            if (name_wert[i] == '_') {
                   break;
            }
        }

        for (let i = 0; i < length(name_time); i++) {
            arg_time = arg_time + name_wert[i];  
            if (name_wert[i] == '_') {
                   break;
            }
        }
        
        //co2_in=200,time=200,
        answer = arg_wert + ort.val() + "=" + wert.val() + "," + arg_time + ort.val() + "=" + time.val() + ",";
        return answer;
    }



    //submitForm
    function submitForm(modal_id, form_id, name_ort, name_wert, name_time) {        
        if (validateForm(form_id, name_wert, name_time)) {
            post(generatePostString(form_id, name_ort, name_wert, name_time));
            closemodal(modal_id);
        }
    }

    //resetForm
    function resetForm(id) {
        form = document.getElementById(id);
        form.reset();
    }

    //POST
    function post(arg){
        var ip = location.host;
        var xhttp = new XMLHttpRequest();
        
        xhttp.open("POST", "http://"+ip+"/postform/", true); // true for asynchronous request
        xhttp.setRequestHeader("Content-type", "text/plain");
        xhttp.send(arg);
    
    }

    //GET
    function get(arg) {
        var ip = location.host;
        var xhttp = new XMLHttpRequest();

        xhttp.open("GET", "http://"+ip+"/getform/"+arg, false ); // false for synchronous request
        xhttp.send(null);
    
        return xhttp.responseText;
    }

    //Update DIV
    function updateDiv(arg) {
        move(get(arg));
    }

    //UpdateFunction
    function update(){ 
        updateDiv();
    }


    function move() {
        var i = 0;
    if (i == 0) {
        i = 1;
        var elem = document.getElementById("myBar");
        var width = 10;
        var id = setInterval(frame, 10);
        function frame() {
        if (width >= 100) {
            clearInterval(id);
            i = 0;
        } else {
            width++;
            elem.style.width = width + "%";
            elem.innerHTML = width + "%";
        }
        }
    }
    }

    //Updates Intervallmäßig ausführen --> Default 1000ms (machts aber nur einmal am anfang)
    window.setInterval(update(), 1000);
    /*
    while (true) {
        update();    
    }
    */
</script>
 
</body>
</html>